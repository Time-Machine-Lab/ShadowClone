name: get pull request info for Dingding

on:
  pull_request:

jobs:
  spring-boot:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
    - name: checkout
      uses: actions/checkout@v2
      
    # æ­¤å¤„çœç•¥å…·ä½“çš„ä¸šåŠ¡ä»£ç     
   
    # è·å–PRä¿¡æ¯å¹¶å°†å…¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡
    - name: set PR_INFO 
      run: |
        echo PR_NUMBER=$(echo $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }') >> $GITHUB_ENV
        echo PR_TITLE=$(jq --raw-output .pull_request.title "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
        echo PR_URL=$(jq --raw-output .pull_request.html_url "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
        echo PR_USER=$(jq --raw-output .pull_request.user.login "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
    
    # æ‰“å°ç¯å¢ƒå˜é‡
    - name: print env
      run: printenv
     
    # # å‘é€æ£€æŸ¥
    # - name: build success
    #   if: ${{ success() }}
    #   uses: fifsky/dingtalk-action@master
    #   with:
    #     url: https://oapi.dingtalk.com/robot/send?access_token=è¿™é‡Œå†™é’‰é’‰æœºå™¨äººçš„token
    #     type: markdown
    #     content: |
    #       # ğŸ’¯ğŸ‘¨â€ğŸ’» Success ğŸ‰ğŸ‰ğŸ‰
    #       > Maven Build of [# ${{ env.PR_TITLE }}](${{ env.PR_URL }}) by ${{ env.PR_USER }} success
    #       > ^_^ from github action message 
    # - name: maven build failure
    #   if: ${{ failure() }}
    #   uses: fifsky/dingtalk-action@master
    #   with:
    #     url: https://oapi.dingtalk.com/robot/send?access_token=${{ env.DING_TOKEN}}å¦‚æœæ˜¯å…¬æœ‰é¡¹ç›®åˆ™åº”è¯¥åœ¨githubé¡¹ç›®ä¸­ä¾æ¬¡ç‚¹å‡»settings -> secret æ·»åŠ ä¸€ä¸ªDING_TOKENï¼Œå¹¶è®¾ç½®ä¸ºè‡ªå·±çš„é’‰é’‰æœºå™¨äººtoken
    #     type: markdown
    #     content: |
    #       # ğŸ’¤ğŸ¤·â€â™€ï¸ failure ğŸ™…â€â™‚ï¸ğŸ’£
    #       > Maven Build of [# ${{ env.PR_TITLE }}](${{ env.PR_URL }}) by ${{ env.PR_USER }} failure
    #       > (â‹Ÿï¹â‹)   from github action message
